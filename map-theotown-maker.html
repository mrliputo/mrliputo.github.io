<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TheoTown Region Maker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            gap: 20px;
            background: #222;
            color: #fff;
            margin: 10px;
        }

        #panel {
            width: 280px;
            flex-shrink: 0;
        }

        label {
            display: block;
            margin-top: 8px;
            font-size: 13px;
        }

        input, button, textarea, select {
            width: 100%;
            margin-top: 4px;
            box-sizing: border-box;
        }

        button {
            padding: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-row {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .btn-row button {
            flex: 1;
        }

        #gridContainer {
            width: 600px;
            height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #grid {
            display: grid;
            background: #eee;
            position: relative;
        }

        .cell {
            border: 1px solid #ddd;
            background: #fff;
            box-sizing: border-box;
        }

        .block {
            position: absolute;
            background: rgba(0, 100, 200, 0.8);
            cursor: move;
            box-sizing: border-box;
            color: #fff;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            border: 1px solid #0af;
            border-radius: 2px;
            user-select: none;
            overflow: hidden;
        }

        .block:hover {
            background: rgba(0, 150, 255, 0.9);
        }

        .block.selected {
            border-color: #ff0;
            background: rgba(200, 150, 0, 0.8);
        }

        .block .coords {
            font-weight: bold;
        }

        .block .size-label {
            font-size: 8px;
            opacity: 0.8;
        }

        .block-controls {
            margin-top: 15px;
            padding: 10px;
            background: #333;
            border-radius: 5px;
            display: none;
        }

        .block-controls.active {
            display: block;
        }

        .block-controls h4 {
            margin: 0 0 10px 0;
            color: #0af;
        }

        #blockList {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
            background: #333;
            border-radius: 5px;
        }

        .block-item {
            padding: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
            cursor: pointer;
        }

        .block-item:hover {
            background: #444;
        }

        .block-item.selected {
            background: #555;
        }

        .block-item button {
            width: auto;
            padding: 4px 8px;
            background: #c00;
            color: #fff;
            border: none;
            border-radius: 3px;
        }

        .block-item button:hover {
            background: #f00;
        }
    </style>
</head>

<body>

<div id="panel">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h3>ğŸ™ï¸ TheoTown Region Maker</h3>
    </div>

    <label id="lblName">Region Name</label>
    <input id="name" value="Test Map">

    <label id="lblSeed">Seed</label>
    <input id="seed" value="12345678">

    <label id="lblSize">Map Size (grid)</label>
    <input id="size" type="number" value="12" min="4">

    <label><input type="checkbox" id="desert"> Desert</label>
    <label><input type="checkbox" id="terrain"> Terrain</label>
    <label><input type="checkbox" id="trees"> Trees</label>
    <label><input type="checkbox" id="decoration" checked> Decoration</label>

    <div class="btn-row">
        <button id="btnAdd" onclick="addBlock()">â• Tambah</button>
        <button id="btnDelete" onclick="deleteSelectedBlock()">ğŸ—‘ï¸ Hapus</button>
    </div>

    <div class="block-controls" id="blockControls">
        <h4 id="lblEditBlock">ğŸ“ Edit Blok Terpilih</h4>
        <label id="lblBlockSize">Ukuran Blok
            <select id="blockSize" onchange="updateBlockSize()">
                <option value="1">1x1</option>
                <option value="2" selected>2x2</option>
                <option value="3">3x3</option>
                <option value="4">4x4</option>
                <option value="5">5x5</option>
                <option value="6">6x6</option>
            </select>
        </label>
    </div>

    <label id="lblBlockList">Daftar Blok</label>
    <div id="blockList"></div>

    <button id="btnGenerate" onclick="generate()" style="margin-top: 15px; background: #080; color: #fff; border: none;">ğŸ“„ Generate Text</button>

    <div id="cityCount" style="margin-top: 10px; padding: 8px; background: #444; border-radius: 5px; text-align: center;">
        ğŸ˜ï¸ <span id="lblCityCount">Jumlah City:</span> <strong id="countValue">0</strong>
    </div>

    <label id="lblOutput">Output</label>
    <textarea id="output" rows="8"></textarea>

    <div style="margin-top: 20px; padding: 10px; background: #333; border-radius: 5px; text-align: center; font-size: 12px;">
        <label id="lblLang" style="color: #888; margin: 0;">Language</label>
        <select id="lang" onchange="changeLanguage()" style="padding: 6px; margin: 8px 0;">
            <option value="en" selected>ğŸ‡¬ğŸ‡§ English</option>
            <option value="id">ğŸ‡®ğŸ‡© Indonesia</option>
            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
            <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
            <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
            <option value="nl">ğŸ‡³ğŸ‡± Nederlands</option>
            <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            <option value="pl">ğŸ‡µğŸ‡± Polski</option>
            <option value="uk">ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</option>
            <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
            <option value="bn">ğŸ‡§ğŸ‡© à¦¬à¦¾à¦‚à¦²à¦¾</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
            <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
            <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
            <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
            <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
            <option value="ms">ğŸ‡²ğŸ‡¾ Bahasa Melayu</option>
            <option value="fil">ğŸ‡µğŸ‡­ Filipino</option>
            <option value="sv">ğŸ‡¸ğŸ‡ª Svenska</option>
            <option value="da">ğŸ‡©ğŸ‡° Dansk</option>
            <option value="no">ğŸ‡³ğŸ‡´ Norsk</option>
            <option value="fi">ğŸ‡«ğŸ‡® Suomi</option>
            <option value="el">ğŸ‡¬ğŸ‡· Î•Î»Î»Î·Î½Î¹ÎºÎ¬</option>
            <option value="cs">ğŸ‡¨ğŸ‡¿ ÄŒeÅ¡tina</option>
            <option value="ro">ğŸ‡·ğŸ‡´ RomÃ¢nÄƒ</option>
            <option value="hu">ğŸ‡­ğŸ‡º Magyar</option>
            <option value="he">ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª</option>
            <option value="fa">ğŸ‡®ğŸ‡· ÙØ§Ø±Ø³ÛŒ</option>
        </select>
        <div style="color: #888;">Created by</div>
        <a href="https://x.com/mrliputo" target="_blank" style="color: #0af; text-decoration: none;">@mrliputo</a>
        <div style="color: #666; margin-top: 5px;">on X (Twitter)</div>
    </div>
</div>

<div id="gridContainer">
    <div id="grid"></div>
</div>

<script>
    let size = 12;
    let cellSize = 40;
    let blocks = [];
    let drag = null;
    let selectedBlock = null;
    let blockIdCounter = 0;
    let currentLang = 'en';

    // Terjemahan 32 bahasa
    const translations = {
        id: {
            lblLang: "Bahasa",
            lblName: "Nama Wilayah",
            lblSeed: "Seed",
            lblSize: "Ukuran Peta (grid)",
            btnAdd: "â• Tambah",
            btnDelete: "ğŸ—‘ï¸ Hapus",
            lblEditBlock: "ğŸ“ Edit Blok Terpilih",
            lblBlockSize: "Ukuran Blok",
            lblBlockList: "Daftar Blok",
            btnGenerate: "ğŸ“„ Generate Text",
            lblCityCount: "Jumlah City:",
            lblOutput: "Output",
            alertSelectBlock: "Pilih blok terlebih dahulu!",
            blockLabel: "Blok"
        },
        en: {
            lblLang: "Language",
            lblName: "Region Name",
            lblSeed: "Seed",
            lblSize: "Map Size (grid)",
            btnAdd: "â• Add",
            btnDelete: "ğŸ—‘ï¸ Delete",
            lblEditBlock: "ğŸ“ Edit Selected Block",
            lblBlockSize: "Block Size",
            lblBlockList: "Block List",
            btnGenerate: "ğŸ“„ Generate Text",
            lblCityCount: "City Count:",
            lblOutput: "Output",
            alertSelectBlock: "Select a block first!",
            blockLabel: "Block"
        },
        es: {
            lblLang: "Idioma",
            lblName: "Nombre de RegiÃ³n",
            lblSeed: "Semilla",
            lblSize: "TamaÃ±o del Mapa (cuadrÃ­cula)",
            btnAdd: "â• AÃ±adir",
            btnDelete: "ğŸ—‘ï¸ Eliminar",
            lblEditBlock: "ğŸ“ Editar Bloque Seleccionado",
            lblBlockSize: "TamaÃ±o del Bloque",
            lblBlockList: "Lista de Bloques",
            btnGenerate: "ğŸ“„ Generar Texto",
            lblCityCount: "Cantidad de Ciudades:",
            lblOutput: "Salida",
            alertSelectBlock: "Â¡Selecciona un bloque primero!",
            blockLabel: "Bloque"
        },
        fr: {
            lblLang: "Langue",
            lblName: "Nom de la RÃ©gion",
            lblSeed: "Graine",
            lblSize: "Taille de la Carte (grille)",
            btnAdd: "â• Ajouter",
            btnDelete: "ğŸ—‘ï¸ Supprimer",
            lblEditBlock: "ğŸ“ Modifier le Bloc SÃ©lectionnÃ©",
            lblBlockSize: "Taille du Bloc",
            lblBlockList: "Liste des Blocs",
            btnGenerate: "ğŸ“„ GÃ©nÃ©rer le Texte",
            lblCityCount: "Nombre de Villes:",
            lblOutput: "Sortie",
            alertSelectBlock: "SÃ©lectionnez d'abord un bloc!",
            blockLabel: "Bloc"
        },
        de: {
            lblLang: "Sprache",
            lblName: "Regionsname",
            lblSeed: "Seed",
            lblSize: "KartengrÃ¶ÃŸe (Raster)",
            btnAdd: "â• HinzufÃ¼gen",
            btnDelete: "ğŸ—‘ï¸ LÃ¶schen",
            lblEditBlock: "ğŸ“ AusgewÃ¤hlten Block Bearbeiten",
            lblBlockSize: "BlockgrÃ¶ÃŸe",
            lblBlockList: "Blockliste",
            btnGenerate: "ğŸ“„ Text Generieren",
            lblCityCount: "Stadtanzahl:",
            lblOutput: "Ausgabe",
            alertSelectBlock: "WÃ¤hlen Sie zuerst einen Block!",
            blockLabel: "Block"
        },
        it: {
            lblLang: "Lingua",
            lblName: "Nome Regione",
            lblSeed: "Seme",
            lblSize: "Dimensione Mappa (griglia)",
            btnAdd: "â• Aggiungi",
            btnDelete: "ğŸ—‘ï¸ Elimina",
            lblEditBlock: "ğŸ“ Modifica Blocco Selezionato",
            lblBlockSize: "Dimensione Blocco",
            lblBlockList: "Lista Blocchi",
            btnGenerate: "ğŸ“„ Genera Testo",
            lblCityCount: "Conteggio CittÃ :",
            lblOutput: "Output",
            alertSelectBlock: "Seleziona prima un blocco!",
            blockLabel: "Blocco"
        },
        pt: {
            lblLang: "Idioma",
            lblName: "Nome da RegiÃ£o",
            lblSeed: "Semente",
            lblSize: "Tamanho do Mapa (grade)",
            btnAdd: "â• Adicionar",
            btnDelete: "ğŸ—‘ï¸ Excluir",
            lblEditBlock: "ğŸ“ Editar Bloco Selecionado",
            lblBlockSize: "Tamanho do Bloco",
            lblBlockList: "Lista de Blocos",
            btnGenerate: "ğŸ“„ Gerar Texto",
            lblCityCount: "Contagem de Cidades:",
            lblOutput: "SaÃ­da",
            alertSelectBlock: "Selecione um bloco primeiro!",
            blockLabel: "Bloco"
        },
        nl: {
            lblLang: "Taal",
            lblName: "Regionaam",
            lblSeed: "Zaad",
            lblSize: "Kaartgrootte (raster)",
            btnAdd: "â• Toevoegen",
            btnDelete: "ğŸ—‘ï¸ Verwijderen",
            lblEditBlock: "ğŸ“ Geselecteerd Blok Bewerken",
            lblBlockSize: "Blokgrootte",
            lblBlockList: "Blokkenlijst",
            btnGenerate: "ğŸ“„ Tekst Genereren",
            lblCityCount: "Aantal Steden:",
            lblOutput: "Uitvoer",
            alertSelectBlock: "Selecteer eerst een blok!",
            blockLabel: "Blok"
        },
        ru: {
            lblLang: "Ğ¯Ğ·Ñ‹Ğº",
            lblName: "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ ĞµĞ³Ğ¸Ğ¾Ğ½Ğ°",
            lblSeed: "Ğ¡Ğ¸Ğ´",
            lblSize: "Ğ Ğ°Ğ·Ğ¼ĞµÑ€ ĞšĞ°Ñ€Ñ‚Ñ‹ (ÑĞµÑ‚ĞºĞ°)",
            btnAdd: "â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ",
            btnDelete: "ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ",
            lblEditBlock: "ğŸ“ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ‘Ğ»Ğ¾Ğº",
            lblBlockSize: "Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ‘Ğ»Ğ¾ĞºĞ°",
            lblBlockList: "Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ‘Ğ»Ğ¾ĞºĞ¾Ğ²",
            btnGenerate: "ğŸ“„ Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¢ĞµĞºÑÑ‚",
            lblCityCount: "ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ“Ğ¾Ñ€Ğ¾Ğ´Ğ¾Ğ²:",
            lblOutput: "Ğ’Ñ‹Ğ²Ğ¾Ğ´",
            alertSelectBlock: "Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ±Ğ»Ğ¾Ğº!",
            blockLabel: "Ğ‘Ğ»Ğ¾Ğº"
        },
        pl: {
            lblLang: "JÄ™zyk",
            lblName: "Nazwa Regionu",
            lblSeed: "Ziarno",
            lblSize: "Rozmiar Mapy (siatka)",
            btnAdd: "â• Dodaj",
            btnDelete: "ğŸ—‘ï¸ UsuÅ„",
            lblEditBlock: "ğŸ“ Edytuj Wybrany Blok",
            lblBlockSize: "Rozmiar Bloku",
            lblBlockList: "Lista BlokÃ³w",
            btnGenerate: "ğŸ“„ Generuj Tekst",
            lblCityCount: "Liczba Miast:",
            lblOutput: "WyjÅ›cie",
            alertSelectBlock: "Najpierw wybierz blok!",
            blockLabel: "Blok"
        },
        uk: {
            lblLang: "ĞœĞ¾Ğ²Ğ°",
            lblName: "ĞĞ°Ğ·Ğ²Ğ° Ğ ĞµĞ³Ñ–Ğ¾Ğ½Ñƒ",
            lblSeed: "Ğ¡Ñ–Ğ´",
            lblSize: "Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€ ĞšĞ°Ñ€Ñ‚Ğ¸ (ÑÑ–Ñ‚ĞºĞ°)",
            btnAdd: "â• Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸",
            btnDelete: "ğŸ—‘ï¸ Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸",
            lblEditBlock: "ğŸ“ Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ’Ğ¸Ğ±Ñ€Ğ°Ğ½Ğ¸Ğ¹ Ğ‘Ğ»Ğ¾Ğº",
            lblBlockSize: "Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€ Ğ‘Ğ»Ğ¾ĞºÑƒ",
            lblBlockList: "Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ‘Ğ»Ğ¾ĞºÑ–Ğ²",
            btnGenerate: "ğŸ“„ Ğ—Ğ³ĞµĞ½ĞµÑ€ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ¢ĞµĞºÑÑ‚",
            lblCityCount: "ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ ĞœÑ–ÑÑ‚:",
            lblOutput: "Ğ’Ğ¸Ğ²Ñ–Ğ´",
            alertSelectBlock: "Ğ¡Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºÑƒ Ğ²Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ±Ğ»Ğ¾Ğº!",
            blockLabel: "Ğ‘Ğ»Ğ¾Ğº"
        },
        tr: {
            lblLang: "Dil",
            lblName: "BÃ¶lge AdÄ±",
            lblSeed: "Tohum",
            lblSize: "Harita Boyutu (Ä±zgara)",
            btnAdd: "â• Ekle",
            btnDelete: "ğŸ—‘ï¸ Sil",
            lblEditBlock: "ğŸ“ SeÃ§ili BloÄŸu DÃ¼zenle",
            lblBlockSize: "Blok Boyutu",
            lblBlockList: "Blok Listesi",
            btnGenerate: "ğŸ“„ Metin OluÅŸtur",
            lblCityCount: "Åehir SayÄ±sÄ±:",
            lblOutput: "Ã‡Ä±ktÄ±",
            alertSelectBlock: "Ã–nce bir blok seÃ§in!",
            blockLabel: "Blok"
        },
        ar: {
            lblLang: "Ø§Ù„Ù„ØºØ©",
            lblName: "Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø©",
            lblSeed: "Ø§Ù„Ø¨Ø°Ø±Ø©",
            lblSize: "Ø­Ø¬Ù… Ø§Ù„Ø®Ø±ÙŠØ·Ø© (Ø´Ø¨ÙƒØ©)",
            btnAdd: "â• Ø¥Ø¶Ø§ÙØ©",
            btnDelete: "ğŸ—‘ï¸ Ø­Ø°Ù",
            lblEditBlock: "ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒØªÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
            lblBlockSize: "Ø­Ø¬Ù… Ø§Ù„ÙƒØªÙ„Ø©",
            lblBlockList: "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØªÙ„",
            btnGenerate: "ğŸ“„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Øµ",
            lblCityCount: "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ù†:",
            lblOutput: "Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª",
            alertSelectBlock: "Ø§Ø®ØªØ± ÙƒØªÙ„Ø© Ø£ÙˆÙ„Ø§Ù‹!",
            blockLabel: "ÙƒØªÙ„Ø©"
        },
        hi: {
            lblLang: "à¤­à¤¾à¤·à¤¾",
            lblName: "à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤•à¤¾ à¤¨à¤¾à¤®",
            lblSeed: "à¤¬à¥€à¤œ",
            lblSize: "à¤®à¤¾à¤¨à¤šà¤¿à¤¤à¥à¤° à¤†à¤•à¤¾à¤° (à¤—à¥à¤°à¤¿à¤¡)",
            btnAdd: "â• à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
            btnDelete: "ğŸ—‘ï¸ à¤¹à¤Ÿà¤¾à¤à¤‚",
            lblEditBlock: "ğŸ“ à¤šà¤¯à¤¨à¤¿à¤¤ à¤¬à¥à¤²à¥‰à¤• à¤¸à¤‚à¤ªà¤¾à¤¦à¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
            lblBlockSize: "à¤¬à¥à¤²à¥‰à¤• à¤†à¤•à¤¾à¤°",
            lblBlockList: "à¤¬à¥à¤²à¥‰à¤• à¤¸à¥‚à¤šà¥€",
            btnGenerate: "ğŸ“„ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ à¤œà¤¨à¤°à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚",
            lblCityCount: "à¤¶à¤¹à¤° à¤—à¤¿à¤¨à¤¤à¥€:",
            lblOutput: "à¤†à¤‰à¤Ÿà¤ªà¥à¤Ÿ",
            alertSelectBlock: "à¤ªà¤¹à¤²à¥‡ à¤à¤• à¤¬à¥à¤²à¥‰à¤• à¤šà¥à¤¨à¥‡à¤‚!",
            blockLabel: "à¤¬à¥à¤²à¥‰à¤•"
        },
        bn: {
            lblLang: "à¦­à¦¾à¦·à¦¾",
            lblName: "à¦…à¦à§à¦šà¦²à§‡à¦° à¦¨à¦¾à¦®",
            lblSeed: "à¦¬à§€à¦œ",
            lblSize: "à¦®à¦¾à¦¨à¦šà¦¿à¦¤à§à¦°à§‡à¦° à¦†à¦•à¦¾à¦° (à¦—à§à¦°à¦¿à¦¡)",
            btnAdd: "â• à¦¯à§‹à¦— à¦•à¦°à§à¦¨",
            btnDelete: "ğŸ—‘ï¸ à¦®à§à¦›à§à¦¨",
            lblEditBlock: "ğŸ“ à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¿à¦¤ à¦¬à§à¦²à¦• à¦¸à¦®à§à¦ªà¦¾à¦¦à¦¨à¦¾ à¦•à¦°à§à¦¨",
            lblBlockSize: "à¦¬à§à¦²à¦•à§‡à¦° à¦†à¦•à¦¾à¦°",
            lblBlockList: "à¦¬à§à¦²à¦• à¦¤à¦¾à¦²à¦¿à¦•à¦¾",
            btnGenerate: "ğŸ“„ à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦¤à§ˆà¦°à¦¿ à¦•à¦°à§à¦¨",
            lblCityCount: "à¦¶à¦¹à¦° à¦—à¦£à¦¨à¦¾:",
            lblOutput: "à¦†à¦‰à¦Ÿà¦ªà§à¦Ÿ",
            alertSelectBlock: "à¦ªà§à¦°à¦¥à¦®à§‡ à¦à¦•à¦Ÿà¦¿ à¦¬à§à¦²à¦• à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¨ à¦•à¦°à§à¦¨!",
            blockLabel: "à¦¬à§à¦²à¦•"
        },
        zh: {
            lblLang: "è¯­è¨€",
            lblName: "åŒºåŸŸåç§°",
            lblSeed: "ç§å­",
            lblSize: "åœ°å›¾å¤§å°ï¼ˆç½‘æ ¼ï¼‰",
            btnAdd: "â• æ·»åŠ ",
            btnDelete: "ğŸ—‘ï¸ åˆ é™¤",
            lblEditBlock: "ğŸ“ ç¼–è¾‘é€‰ä¸­çš„æ–¹å—",
            lblBlockSize: "æ–¹å—å¤§å°",
            lblBlockList: "æ–¹å—åˆ—è¡¨",
            btnGenerate: "ğŸ“„ ç”Ÿæˆæ–‡æœ¬",
            lblCityCount: "åŸå¸‚æ•°é‡:",
            lblOutput: "è¾“å‡º",
            alertSelectBlock: "è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–¹å—ï¼",
            blockLabel: "æ–¹å—"
        },
        ja: {
            lblLang: "è¨€èª",
            lblName: "åœ°åŸŸå",
            lblSeed: "ã‚·ãƒ¼ãƒ‰",
            lblSize: "ãƒãƒƒãƒ—ã‚µã‚¤ã‚ºï¼ˆã‚°ãƒªãƒƒãƒ‰ï¼‰",
            btnAdd: "â• è¿½åŠ ",
            btnDelete: "ğŸ—‘ï¸ å‰Šé™¤",
            lblEditBlock: "ğŸ“ é¸æŠã—ãŸãƒ–ãƒ­ãƒƒã‚¯ã‚’ç·¨é›†",
            lblBlockSize: "ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚º",
            lblBlockList: "ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆ",
            btnGenerate: "ğŸ“„ ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ",
            lblCityCount: "éƒ½å¸‚æ•°:",
            lblOutput: "å‡ºåŠ›",
            alertSelectBlock: "å…ˆã«ãƒ–ãƒ­ãƒƒã‚¯ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼",
            blockLabel: "ãƒ–ãƒ­ãƒƒã‚¯"
        },
        ko: {
            lblLang: "ì–¸ì–´",
            lblName: "ì§€ì—­ ì´ë¦„",
            lblSeed: "ì‹œë“œ",
            lblSize: "ë§µ í¬ê¸° (ê·¸ë¦¬ë“œ)",
            btnAdd: "â• ì¶”ê°€",
            btnDelete: "ğŸ—‘ï¸ ì‚­ì œ",
            lblEditBlock: "ğŸ“ ì„ íƒí•œ ë¸”ë¡ í¸ì§‘",
            lblBlockSize: "ë¸”ë¡ í¬ê¸°",
            lblBlockList: "ë¸”ë¡ ëª©ë¡",
            btnGenerate: "ğŸ“„ í…ìŠ¤íŠ¸ ìƒì„±",
            lblCityCount: "ë„ì‹œ ìˆ˜:",
            lblOutput: "ì¶œë ¥",
            alertSelectBlock: "ë¨¼ì € ë¸”ë¡ì„ ì„ íƒí•˜ì„¸ìš”!",
            blockLabel: "ë¸”ë¡"
        },
        vi: {
            lblLang: "NgÃ´n ngá»¯",
            lblName: "TÃªn VÃ¹ng",
            lblSeed: "Háº¡t giá»‘ng",
            lblSize: "KÃ­ch thÆ°á»›c Báº£n Ä‘á»“ (lÆ°á»›i)",
            btnAdd: "â• ThÃªm",
            btnDelete: "ğŸ—‘ï¸ XÃ³a",
            lblEditBlock: "ğŸ“ Chá»‰nh sá»­a Khá»‘i Ä‘Ã£ Chá»n",
            lblBlockSize: "KÃ­ch thÆ°á»›c Khá»‘i",
            lblBlockList: "Danh sÃ¡ch Khá»‘i",
            btnGenerate: "ğŸ“„ Táº¡o VÄƒn báº£n",
            lblCityCount: "Sá»‘ lÆ°á»£ng ThÃ nh phá»‘:",
            lblOutput: "Äáº§u ra",
            alertSelectBlock: "Vui lÃ²ng chá»n má»™t khá»‘i trÆ°á»›c!",
            blockLabel: "Khá»‘i"
        },
        th: {
            lblLang: "à¸ à¸²à¸©à¸²",
            lblName: "à¸Šà¸·à¹ˆà¸­à¸ à¸¹à¸¡à¸´à¸ à¸²à¸„",
            lblSeed: "à¹€à¸¡à¸¥à¹‡à¸”",
            lblSize: "à¸‚à¸™à¸²à¸”à¹à¸œà¸™à¸—à¸µà¹ˆ (à¸•à¸²à¸£à¸²à¸‡)",
            btnAdd: "â• à¹€à¸à¸´à¹ˆà¸¡",
            btnDelete: "ğŸ—‘ï¸ à¸¥à¸š",
            lblEditBlock: "ğŸ“ à¹à¸à¹‰à¹„à¸‚à¸šà¸¥à¹‡à¸­à¸à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸",
            lblBlockSize: "à¸‚à¸™à¸²à¸”à¸šà¸¥à¹‡à¸­à¸",
            lblBlockList: "à¸£à¸²à¸¢à¸à¸²à¸£à¸šà¸¥à¹‡à¸­à¸",
            btnGenerate: "ğŸ“„ à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡",
            lblCityCount: "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸¡à¸·à¸­à¸‡:",
            lblOutput: "à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ",
            alertSelectBlock: "à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸šà¸¥à¹‡à¸­à¸à¸à¹ˆà¸­à¸™!",
            blockLabel: "à¸šà¸¥à¹‡à¸­à¸"
        },
        ms: {
            lblLang: "Bahasa",
            lblName: "Nama Wilayah",
            lblSeed: "Benih",
            lblSize: "Saiz Peta (grid)",
            btnAdd: "â• Tambah",
            btnDelete: "ğŸ—‘ï¸ Padam",
            lblEditBlock: "ğŸ“ Edit Blok Dipilih",
            lblBlockSize: "Saiz Blok",
            lblBlockList: "Senarai Blok",
            btnGenerate: "ğŸ“„ Jana Teks",
            lblCityCount: "Bilangan Bandar:",
            lblOutput: "Output",
            alertSelectBlock: "Pilih blok dahulu!",
            blockLabel: "Blok"
        },
        fil: {
            lblLang: "Wika",
            lblName: "Pangalan ng Rehiyon",
            lblSeed: "Binhi",
            lblSize: "Laki ng Mapa (grid)",
            btnAdd: "â• Idagdag",
            btnDelete: "ğŸ—‘ï¸ Tanggalin",
            lblEditBlock: "ğŸ“ I-edit ang Napiling Block",
            lblBlockSize: "Laki ng Block",
            lblBlockList: "Listahan ng Block",
            btnGenerate: "ğŸ“„ Gumawa ng Teksto",
            lblCityCount: "Bilang ng Lungsod:",
            lblOutput: "Output",
            alertSelectBlock: "Pumili muna ng block!",
            blockLabel: "Block"
        },
        sv: {
            lblLang: "SprÃ¥k",
            lblName: "Regionsnamn",
            lblSeed: "FrÃ¶",
            lblSize: "Kartstorlek (rutnÃ¤t)",
            btnAdd: "â• LÃ¤gg till",
            btnDelete: "ğŸ—‘ï¸ Ta bort",
            lblEditBlock: "ğŸ“ Redigera Valt Block",
            lblBlockSize: "Blockstorlek",
            lblBlockList: "Blocklista",
            btnGenerate: "ğŸ“„ Generera Text",
            lblCityCount: "Antal StÃ¤der:",
            lblOutput: "Utdata",
            alertSelectBlock: "VÃ¤lj ett block fÃ¶rst!",
            blockLabel: "Block"
        },
        da: {
            lblLang: "Sprog",
            lblName: "Regionsnavn",
            lblSeed: "FrÃ¸",
            lblSize: "KortstÃ¸rrelse (gitter)",
            btnAdd: "â• TilfÃ¸j",
            btnDelete: "ğŸ—‘ï¸ Slet",
            lblEditBlock: "ğŸ“ Rediger Valgt Blok",
            lblBlockSize: "BlokstÃ¸rrelse",
            lblBlockList: "Blokliste",
            btnGenerate: "ğŸ“„ Generer Tekst",
            lblCityCount: "Antal Byer:",
            lblOutput: "Output",
            alertSelectBlock: "VÃ¦lg en blok fÃ¸rst!",
            blockLabel: "Blok"
        },
        no: {
            lblLang: "SprÃ¥k",
            lblName: "Regionsnavn",
            lblSeed: "FrÃ¸",
            lblSize: "KartstÃ¸rrelse (rutenett)",
            btnAdd: "â• Legg til",
            btnDelete: "ğŸ—‘ï¸ Slett",
            lblEditBlock: "ğŸ“ Rediger Valgt Blokk",
            lblBlockSize: "BlokkstÃ¸rrelse",
            lblBlockList: "Blokkliste",
            btnGenerate: "ğŸ“„ Generer Tekst",
            lblCityCount: "Antall Byer:",
            lblOutput: "Utdata",
            alertSelectBlock: "Velg en blokk fÃ¸rst!",
            blockLabel: "Blokk"
        },
        fi: {
            lblLang: "Kieli",
            lblName: "Alueen Nimi",
            lblSeed: "Siemen",
            lblSize: "Kartan Koko (ruudukko)",
            btnAdd: "â• LisÃ¤Ã¤",
            btnDelete: "ğŸ—‘ï¸ Poista",
            lblEditBlock: "ğŸ“ Muokkaa Valittua Lohkoa",
            lblBlockSize: "Lohkon Koko",
            lblBlockList: "Lohkolista",
            btnGenerate: "ğŸ“„ Luo Teksti",
            lblCityCount: "Kaupunkien MÃ¤Ã¤rÃ¤:",
            lblOutput: "Tuloste",
            alertSelectBlock: "Valitse ensin lohko!",
            blockLabel: "Lohko"
        },
        el: {
            lblLang: "Î“Î»ÏÏƒÏƒÎ±",
            lblName: "ÎŒÎ½Î¿Î¼Î± Î ÎµÏÎ¹Î¿Ï‡Î®Ï‚",
            lblSeed: "Î£Ï€ÏŒÏÎ¿Ï‚",
            lblSize: "ÎœÎ­Î³ÎµÎ¸Î¿Ï‚ Î§Î¬ÏÏ„Î· (Ï€Î»Î­Î³Î¼Î±)",
            btnAdd: "â• Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·",
            btnDelete: "ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î®",
            lblEditBlock: "ğŸ“ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿Ï… ÎœÏ€Î»Î¿Îº",
            lblBlockSize: "ÎœÎ­Î³ÎµÎ¸Î¿Ï‚ ÎœÏ€Î»Î¿Îº",
            lblBlockList: "Î›Î¯ÏƒÏ„Î± ÎœÏ€Î»Î¿Îº",
            btnGenerate: "ğŸ“„ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎšÎµÎ¹Î¼Î­Î½Î¿Ï…",
            lblCityCount: "Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î ÏŒÎ»ÎµÏ‰Î½:",
            lblOutput: "ÎˆÎ¾Î¿Î´Î¿Ï‚",
            alertSelectBlock: "Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏÏÏ„Î± Î­Î½Î± Î¼Ï€Î»Î¿Îº!",
            blockLabel: "ÎœÏ€Î»Î¿Îº"
        },
        cs: {
            lblLang: "Jazyk",
            lblName: "NÃ¡zev Regionu",
            lblSeed: "SemÃ­nko",
            lblSize: "Velikost Mapy (mÅ™Ã­Å¾ka)",
            btnAdd: "â• PÅ™idat",
            btnDelete: "ğŸ—‘ï¸ Smazat",
            lblEditBlock: "ğŸ“ Upravit VybranÃ½ Blok",
            lblBlockSize: "Velikost Bloku",
            lblBlockList: "Seznam BlokÅ¯",
            btnGenerate: "ğŸ“„ Vygenerovat Text",
            lblCityCount: "PoÄet MÄ›st:",
            lblOutput: "VÃ½stup",
            alertSelectBlock: "Nejprve vyberte blok!",
            blockLabel: "Blok"
        },
        ro: {
            lblLang: "LimbÄƒ",
            lblName: "Numele Regiunii",
            lblSeed: "SÄƒmÃ¢nÈ›Äƒ",
            lblSize: "Dimensiunea HÄƒrÈ›ii (grilÄƒ)",
            btnAdd: "â• AdaugÄƒ",
            btnDelete: "ğŸ—‘ï¸ È˜terge",
            lblEditBlock: "ğŸ“ EditeazÄƒ Blocul Selectat",
            lblBlockSize: "Dimensiunea Blocului",
            lblBlockList: "Lista Blocurilor",
            btnGenerate: "ğŸ“„ GenereazÄƒ Text",
            lblCityCount: "NumÄƒr de OraÈ™e:",
            lblOutput: "IeÈ™ire",
            alertSelectBlock: "SelectaÈ›i mai Ã®ntÃ¢i un bloc!",
            blockLabel: "Bloc"
        },
        hu: {
            lblLang: "Nyelv",
            lblName: "RÃ©giÃ³ Neve",
            lblSeed: "Mag",
            lblSize: "TÃ©rkÃ©p MÃ©rete (rÃ¡cs)",
            btnAdd: "â• HozzÃ¡adÃ¡s",
            btnDelete: "ğŸ—‘ï¸ TÃ¶rlÃ©s",
            lblEditBlock: "ğŸ“ KivÃ¡lasztott Blokk SzerkesztÃ©se",
            lblBlockSize: "Blokk MÃ©rete",
            lblBlockList: "Blokklista",
            btnGenerate: "ğŸ“„ SzÃ¶veg GenerÃ¡lÃ¡sa",
            lblCityCount: "VÃ¡rosok SzÃ¡ma:",
            lblOutput: "Kimenet",
            alertSelectBlock: "ElÅ‘szÃ¶r vÃ¡lasszon ki egy blokkot!",
            blockLabel: "Blokk"
        },
        he: {
            lblLang: "×©×¤×”",
            lblName: "×©× ×”××–×•×¨",
            lblSeed: "×–×¨×¢",
            lblSize: "×’×•×“×œ ×”××¤×” (×¨×©×ª)",
            btnAdd: "â• ×”×•×¡×£",
            btnDelete: "ğŸ—‘ï¸ ××—×§",
            lblEditBlock: "ğŸ“ ×¢×¨×•×š ×‘×œ×•×§ × ×‘×—×¨",
            lblBlockSize: "×’×•×“×œ ×”×‘×œ×•×§",
            lblBlockList: "×¨×©×™××ª ×‘×œ×•×§×™×",
            btnGenerate: "ğŸ“„ ×¦×•×¨ ×˜×§×¡×˜",
            lblCityCount: "××¡×¤×¨ ×¢×¨×™×:",
            lblOutput: "×¤×œ×˜",
            alertSelectBlock: "×‘×—×¨ ×‘×œ×•×§ ×§×•×“×!",
            blockLabel: "×‘×œ×•×§"
        },
        fa: {
            lblLang: "Ø²Ø¨Ø§Ù†",
            lblName: "Ù†Ø§Ù… Ù…Ù†Ø·Ù‚Ù‡",
            lblSeed: "Ø¨Ø°Ø±",
            lblSize: "Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù†Ù‚Ø´Ù‡ (Ø´Ø¨Ú©Ù‡)",
            btnAdd: "â• Ø§ÙØ²ÙˆØ¯Ù†",
            btnDelete: "ğŸ—‘ï¸ Ø­Ø°Ù",
            lblEditBlock: "ğŸ“ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¨Ù„ÙˆÚ© Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡",
            lblBlockSize: "Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¨Ù„ÙˆÚ©",
            lblBlockList: "Ù„ÛŒØ³Øª Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§",
            btnGenerate: "ğŸ“„ Ø§ÛŒØ¬Ø§Ø¯ Ù…ØªÙ†",
            lblCityCount: "ØªØ¹Ø¯Ø§Ø¯ Ø´Ù‡Ø±Ù‡Ø§:",
            lblOutput: "Ø®Ø±ÙˆØ¬ÛŒ",
            alertSelectBlock: "Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¨Ù„ÙˆÚ© Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!",
            blockLabel: "Ø¨Ù„ÙˆÚ©"
        }
    };

    function changeLanguage() {
        currentLang = document.getElementById("lang").value;
        const t = translations[currentLang];

        document.getElementById("lblLang").textContent = t.lblLang;
        document.getElementById("lblName").textContent = t.lblName;
        document.getElementById("lblSeed").textContent = t.lblSeed;
        document.getElementById("lblSize").textContent = t.lblSize;
        document.getElementById("btnAdd").textContent = t.btnAdd;
        document.getElementById("btnDelete").textContent = t.btnDelete;
        document.getElementById("lblEditBlock").textContent = t.lblEditBlock;
        document.getElementById("lblBlockSize").childNodes[0].textContent = t.lblBlockSize + " ";
        document.getElementById("lblBlockList").textContent = t.lblBlockList;
        document.getElementById("btnGenerate").textContent = t.btnGenerate;
        document.getElementById("lblCityCount").textContent = t.lblCityCount;
        document.getElementById("lblOutput").textContent = t.lblOutput;

        updateBlockList();
    }

    const gridContainer = document.getElementById("gridContainer");
    const grid = document.getElementById("grid");
    const blockControls = document.getElementById("blockControls");
    const blockList = document.getElementById("blockList");
    const blockSizeInput = document.getElementById("blockSize");

    function updateCityCount() {
        document.getElementById("countValue").textContent = blocks.length;
    }

    // Hitung ukuran cell berdasarkan ukuran map agar muat dalam container
    function calculateCellSize() {
        const containerSize = 580; // Ukuran maksimal grid
        size = parseInt(document.getElementById("size").value) || 12;
        size = Math.max(4, size); // Minimal 4

        cellSize = Math.floor(containerSize / size);
        cellSize = Math.max(cellSize, 4); // Minimal 4px per cell agar tetap terlihat
    }

    function buildGrid() {
        calculateCellSize();

        // Hapus cells lama
        grid.innerHTML = "";

        grid.style.gridTemplateColumns = `repeat(${size}, ${cellSize}px)`;
        grid.style.width = size * cellSize + "px";
        grid.style.height = size * cellSize + "px";

        // Buat cells - untuk ukuran sangat besar, gunakan border lebih tipis
        const borderStyle = cellSize <= 6 ? '0.5px solid #ddd' : '1px solid #ccc';

        for (let i = 0; i < size * size; i++) {
            const c = document.createElement("div");
            c.className = "cell";
            c.style.width = cellSize + "px";
            c.style.height = cellSize + "px";
            c.style.border = borderStyle;
            grid.appendChild(c);
        }

        // Update posisi dan ukuran semua blocks
        blocks.forEach(b => {
            grid.appendChild(b.element);

            // Pastikan blok tidak keluar dari grid
            const maxX = size - b.w;
            const maxY = size - b.h;
            b.x = Math.min(b.x, Math.max(0, maxX));
            b.y = Math.min(b.y, Math.max(0, maxY));

            // Jika ukuran blok lebih besar dari grid, perkecil
            if (b.w > size) b.w = size;
            if (b.h > size) b.h = size;

            updateBlockPosition(b);
        });

        updateBlockList();
    }

    function updateBlockPosition(block) {
        block.element.style.left = (block.x * cellSize) + "px";
        block.element.style.top = (block.y * cellSize) + "px";
        block.element.style.width = (block.w * cellSize) + "px";
        block.element.style.height = (block.h * cellSize) + "px";

        // Dinamis font size berdasarkan ukuran block
        const blockPixelSize = block.w * cellSize;
        let fontSize = Math.max(6, Math.min(12, Math.floor(blockPixelSize / 4)));
        let labelFontSize = Math.max(5, fontSize - 2);

        // Sembunyikan text jika terlalu kecil
        if (blockPixelSize < 20) {
            block.element.innerHTML = '';
        } else if (blockPixelSize < 35) {
            block.element.innerHTML = `<span class="coords" style="font-size:${fontSize}px">${block.x},${block.y}</span>`;
        } else {
            block.element.innerHTML = `<span class="coords" style="font-size:${fontSize}px">${block.x},${block.y}</span><span class="size-label" style="font-size:${labelFontSize}px">${block.w}x${block.h}</span>`;
        }
    }

    function addBlock() {
        const block = {
            id: ++blockIdCounter,
            x: 0,
            y: 0,
            w: 2,
            h: 2,
            element: null
        };

        const el = document.createElement("div");
        el.className = "block";
        block.element = el;

        el.onmousedown = e => {
            if (e.button === 0) { // Left click
                selectBlock(block);
                drag = {
                    block: block,
                    ox: e.offsetX,
                    oy: e.offsetY
                };
                e.preventDefault();
            }
        };

        // Double click untuk edit
        el.ondblclick = () => {
            selectBlock(block);
        };

        grid.appendChild(el);
        blocks.push(block);

        updateBlockPosition(block);
        selectBlock(block);
        updateBlockList();
    }

    function selectBlock(block) {
        // Deselect previous
        if (selectedBlock) {
            selectedBlock.element.classList.remove('selected');
        }

        selectedBlock = block;

        if (block) {
            block.element.classList.add('selected');
            blockControls.classList.add('active');
            blockSizeInput.value = block.w; // w dan h selalu sama (kotak)
        } else {
            blockControls.classList.remove('active');
        }

        updateBlockList();
    }

    function updateBlockSize() {
        if (!selectedBlock) return;

        let newSize = parseInt(blockSizeInput.value) || 2;

        // Validasi ukuran agar tidak keluar grid
        const maxSize = Math.min(size - selectedBlock.x, size - selectedBlock.y);
        newSize = Math.max(1, Math.min(newSize, maxSize));

        selectedBlock.w = newSize;
        selectedBlock.h = newSize;

        blockSizeInput.value = newSize;

        updateBlockPosition(selectedBlock);
        updateBlockList();
    }

    function deleteSelectedBlock() {
        if (!selectedBlock) {
            alert(translations[currentLang].alertSelectBlock);
            return;
        }

        deleteBlock(selectedBlock);
    }

    function deleteBlock(block) {
        block.element.remove();
        blocks = blocks.filter(b => b !== block);

        if (selectedBlock === block) {
            selectedBlock = null;
            blockControls.classList.remove('active');
        }

        updateBlockList();
    }

    function updateBlockList() {
        blockList.innerHTML = "";
        const t = translations[currentLang];

        blocks.forEach((block, index) => {
            const item = document.createElement("div");
            item.className = "block-item" + (selectedBlock === block ? " selected" : "");
            item.innerHTML = `
                <span>${t.blockLabel} ${index + 1}: (${block.x},${block.y}) ${block.w}x${block.h}</span>
                <button onclick="event.stopPropagation(); deleteBlockByIndex(${index})">âœ–</button>
            `;
            item.onclick = () => selectBlock(block);
            blockList.appendChild(item);
        });

        updateCityCount();
    }

    function deleteBlockByIndex(index) {
        if (index >= 0 && index < blocks.length) {
            deleteBlock(blocks[index]);
        }
    }

    // Event listeners
    document.onmousemove = e => {
        if (!drag) return;

        const rect = grid.getBoundingClientRect();
        let x = e.clientX - rect.left - drag.ox;
        let y = e.clientY - rect.top - drag.oy;

        // Snap to grid
        let gridX = Math.round(x / cellSize);
        let gridY = Math.round(y / cellSize);

        // Clamp to bounds
        gridX = Math.max(0, Math.min(gridX, size - drag.block.w));
        gridY = Math.max(0, Math.min(gridY, size - drag.block.h));

        drag.block.x = gridX;
        drag.block.y = gridY;

        updateBlockPosition(drag.block);
    };

    document.onmouseup = () => {
        if (drag) {
            updateBlockList();
        }
        drag = null;
    };

    // Click on grid to deselect
    grid.onclick = e => {
        if (e.target === grid || e.target.classList.contains('cell')) {
            selectBlock(null);
        }
    };

    // Keyboard shortcut
    document.onkeydown = e => {
        if (e.key === 'Delete' && selectedBlock) {
            deleteSelectedBlock();
        }
    };

    function generate() {
        let maps = [];

        blocks.forEach(b => {
            maps.push(b.x, b.y, b.w);
        });

        const text = `cr:{name:"${name.value}", seed:"${seed.value}", "desert":${desert.checked}, "terrain":${terrain.checked}, "trees":${trees.checked}, "decoration":${decoration.checked}, size:${size}, maps: [${maps.join(",")}]}`;

        output.value = text;
    }

    document.getElementById("size").onchange = buildGrid;

    // Initialize
    buildGrid();
</script>

</body>
</html>
